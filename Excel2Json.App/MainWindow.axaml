<Window xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        x:Class="Excel2Json.App.MainWindow"
        Width="1100" Height="720"
        Title="Excel/CSV 转 JSON 工具"
        Background="#1E1F22"
        DragDrop.AllowDrop="True">
  <Border Margin="16" Padding="20" Background="#25262B" CornerRadius="12">
    <DockPanel>
      <StackPanel DockPanel.Dock="Top" Spacing="6" Margin="0,0,0,12">
        <TextBlock Text="Excel/CSV 转 JSON" FontSize="24" Foreground="#E9EDF4" FontWeight="SemiBold"/>
        <TextBlock Text="按照模块依次完成：选择文件（Excel/CSV）→ 配置格式 → 导出并查看日志 → 右侧实时预览 JSON（所见即所得）。" Foreground="#9DA5B4"/>
      </StackPanel>

      <Grid DragDrop.AllowDrop="True">
        <Grid.ColumnDefinitions>
          <ColumnDefinition Width="2*" MinWidth="520"/>
          <ColumnDefinition Width="Auto"/>
          <ColumnDefinition Width="1.4*" MinWidth="380"/>
        </Grid.ColumnDefinitions>

        <!-- 左侧设置区域 -->
        <ScrollViewer Grid.Column="0"
                      Margin="0,0,6,0"
                      VerticalScrollBarVisibility="Auto"
                      HorizontalScrollBarVisibility="Disabled"
                      Background="Transparent">
          <StackPanel Spacing="12">
            <Border Background="#2F3035" CornerRadius="10" Padding="12">
              <StackPanel Spacing="10">
                <TextBlock Text="基础设置" Foreground="#E9EDF4" FontWeight="SemiBold" FontSize="16"/>
              <Grid RowDefinitions="Auto,Auto" ColumnDefinitions="150,*,Auto,Auto,Auto">
                <StackPanel Grid.Row="0" Grid.Column="0" Orientation="Horizontal" Spacing="6" VerticalAlignment="Center">
                  <TextBlock Foreground="#E9EDF4" Text="Excel/CSV 文件"/>
                  <Button Content="?" Width="22" Height="22" Background="#2F3035" Foreground="#9DA5B4" BorderBrush="#3A3B40" ToolTip.Tip="选择或拖拽 .xlsx/.xls/.csv，左侧为输入，右侧为输出预览。"/>
                </StackPanel>
                <TextBox x:Name="ExcelPathBox" Grid.Row="0" Grid.Column="1" Watermark="选择 .xlsx/.xls/.csv" Background="#1F2024" Foreground="#E9EDF4" BorderBrush="#3A3B40"/>
                <Button x:Name="BrowseExcelButton" Grid.Row="0" Grid.Column="2" Content="浏览" ToolTip.Tip="从文件系统选取 Excel/CSV 文件"/>
                <Button x:Name="ClearSelectionButton" Grid.Row="0" Grid.Column="3" Content="清除" ToolTip.Tip="清空当前选择与状态" Background="#2F3035" Foreground="#E9EDF4" BorderBrush="#3A3B40"/>

                  <StackPanel Grid.Row="1" Grid.Column="0" Orientation="Horizontal" Spacing="6" VerticalAlignment="Center">
                    <TextBlock Foreground="#E9EDF4" Text="输出 JSON"/>
                    <Button Content="?" Width="22" Height="22" Background="#2F3035" Foreground="#9DA5B4" BorderBrush="#3A3B40" ToolTip.Tip="默认与 Excel/CSV 同名 .json；可自定义路径。"/>
                  </StackPanel>
                  <TextBox x:Name="JsonPathBox" Grid.Row="1" Grid.Column="1" Watermark="输出路径" Background="#1F2024" Foreground="#E9EDF4" BorderBrush="#3A3B40"/>
                  <Button x:Name="BrowseJsonButton" Grid.Row="1" Grid.Column="2" Content="浏览" ToolTip.Tip="保存为指定 JSON 路径"/>
                  <Button x:Name="ViewJsonButton" Grid.Row="1" Grid.Column="3" Content="查看" ToolTip.Tip="打开已导出的 JSON 文件" IsEnabled="False"/>
                </Grid>
              </StackPanel>
            </Border>

            <Border Background="#2F3035" CornerRadius="10" Padding="12">
              <StackPanel Spacing="10">
              <TextBlock Text="格式设置" Foreground="#E9EDF4" FontWeight="SemiBold" FontSize="16"/>
              <Grid RowDefinitions="Auto,Auto,Auto,Auto" ColumnDefinitions="150,*">
                <StackPanel Grid.Row="0" Grid.Column="0" Orientation="Horizontal" Spacing="6" VerticalAlignment="Center">
                  <TextBlock Foreground="#E9EDF4" Text="表头行数"/>
                  <Button Content="?" Width="22" Height="22" Background="#2F3035" Foreground="#9DA5B4" BorderBrush="#3A3B40" ToolTip.Tip="列名所在行号（从 1 开始），默认 3；数据从该行之后读取。"/>
                </StackPanel>
                <NumericUpDown x:Name="HeaderRowsBox" Grid.Row="0" Grid.Column="1" Minimum="1" Maximum="50" Value="3" Increment="1" Background="#1F2024" Foreground="#E9EDF4" BorderBrush="#3A3B40"/>

                  <StackPanel Grid.Row="1" Grid.Column="0" Orientation="Horizontal" Spacing="6" VerticalAlignment="Center">
                    <TextBlock Foreground="#E9EDF4" Text="导出编码"/>
                    <Button Content="?" Width="22" Height="22" Background="#2F3035" Foreground="#9DA5B4" BorderBrush="#3A3B40" ToolTip.Tip="设置导出 JSON 文件的编码；常用：utf-8/utf-16/gb2312/gbk/shift-jis 等。"/>
                  </StackPanel>
                  <ComboBox x:Name="EncodingBox" Grid.Row="1" Grid.Column="1" Background="#1F2024" Foreground="#E9EDF4" BorderBrush="#3A3B40" SelectedIndex="0"
                            ToolTip.Tip="选择导出编码">
                    <ComboBoxItem Content="utf-8"/>
                    <ComboBoxItem Content="utf-16"/>
                    <ComboBoxItem Content="utf-16LE"/>
                    <ComboBoxItem Content="utf-16BE"/>
                    <ComboBoxItem Content="gb2312"/>
                    <ComboBoxItem Content="gbk"/>
                    <ComboBoxItem Content="shift-jis"/>
                    <ComboBoxItem Content="big5"/>
                    <ComboBoxItem Content="iso-8859-1"/>
                    <ComboBoxItem Content="windows-1252"/>
                  </ComboBox>

                  <StackPanel Grid.Row="2" Grid.Column="0" Orientation="Horizontal" Spacing="6" VerticalAlignment="Center">
                    <TextBlock Foreground="#E9EDF4" Text="导出日期格式"/>
                    <Button Content="?" Width="22" Height="22" Background="#2F3035" Foreground="#9DA5B4" BorderBrush="#3A3B40" ToolTip.Tip="JSON 中日期时间的输出格式；可选常用模板。"/>
                  </StackPanel>
                <ComboBox x:Name="DateFormatBox" Grid.Row="2" Grid.Column="1" Background="#1F2024" Foreground="#E9EDF4" BorderBrush="#3A3B40" SelectedIndex="0"
                          ToolTip.Tip="常用格式：yyyy-MM-dd HH:mm:ss / yyyy-MM-dd / yyyy/MM/dd HH:mm:ss">
                  <ComboBoxItem Content="yyyy-MM-dd HH:mm:ss"/>
                  <ComboBoxItem Content="yyyy-MM-dd"/>
                  <ComboBoxItem Content="yyyy/MM/dd HH:mm:ss"/>
                  <ComboBoxItem Content="MM/dd/yyyy HH:mm:ss"/>
                </ComboBox>

                <StackPanel Grid.Row="3" Grid.Column="0" Orientation="Horizontal" Spacing="6" VerticalAlignment="Center">
                  <TextBlock Foreground="#E9EDF4" Text="目标 Sheet（自动检测）"/>
                  <Button Content="?" Width="22" Height="22" Background="#2F3035" Foreground="#9DA5B4" BorderBrush="#3A3B40" ToolTip.Tip="自动列出工作簿中的 Sheet；选择后仅导出该 Sheet，默认导出全部（CSV 仅一个 Sheet）。"/>
                </StackPanel>
                <ComboBox x:Name="SheetNameBox" Grid.Row="3" Grid.Column="1" Background="#1F2024" Foreground="#E9EDF4" BorderBrush="#3A3B40" SelectedIndex="0">
                  <ComboBoxItem Content="全部 Sheet（默认）"/>
                </ComboBox>
              </Grid>
            </StackPanel>
          </Border>

            <Border Background="#2F3035" CornerRadius="10" Padding="12">
              <StackPanel Spacing="10">
                <TextBlock Text="导出选项" Foreground="#E9EDF4" FontWeight="SemiBold" FontSize="16"/>
                <Grid RowDefinitions="Auto,Auto" ColumnDefinitions="150,*">
                  <StackPanel Grid.Row="0" Grid.Column="0" Orientation="Horizontal" Spacing="6" VerticalAlignment="Center">
                    <TextBlock Foreground="#E9EDF4" Text="排除前缀"/>
                    <Button Content="?" Width="22" Height="22" Background="#2F3035" Foreground="#9DA5B4" BorderBrush="#3A3B40" ToolTip.Tip="忽略以此前缀开头的表名或列名（键名），例如 # 或 _tmp。"/>
                  </StackPanel>
                  <TextBox x:Name="ExcludePrefixBox" Grid.Row="0" Grid.Column="1" Background="#1F2024" Foreground="#E9EDF4" BorderBrush="#3A3B40" />

                  <WrapPanel Grid.Row="1" Grid.Column="0" Grid.ColumnSpan="2" ItemWidth="160" Margin="0,4,0,0">
                    <CheckBox x:Name="LowercaseBox" Content="Key 小写" Foreground="#E9EDF4" ToolTip.Tip="仅将字段键名转小写，便于前端使用。" Margin="0,0,12,8" />
                    <CheckBox x:Name="ArrayBox" Content="导出为数组" Foreground="#E9EDF4" ToolTip.Tip="以数组输出，而非以首列为键的对象。" Margin="0,0,12,8" />
                    <CheckBox x:Name="ForceSheetBox" Content="保留 Sheet 包装" Foreground="#E9EDF4" ToolTip.Tip="即使只有一个 Sheet 也保留顶层 Sheet 名。" Margin="0,0,12,8" />
                    <CheckBox x:Name="CellJsonBox" Content="识别 JSON 值" Foreground="#E9EDF4" ToolTip.Tip="若单元格内是 JSON 文本，则将该值解析为对象/数组。" Margin="0,0,12,8" />
                    <CheckBox x:Name="AllStringBox" Content="值转字符串" Foreground="#E9EDF4" ToolTip.Tip="将所有输出值转为字符串（键名不受影响），便于弱类型消费。" Margin="0,0,12,8" />
                    <CheckBox x:Name="SingleLineArrayBox" Content="数组按行输出" Foreground="#E9EDF4" ToolTip.Tip="当输出 JSON 为数组时，强制每个元素单独一行展示。" Margin="0,0,12,8" />
                  </WrapPanel>
                </Grid>
              </StackPanel>
            </Border>

            <Border Background="#2F3035" CornerRadius="10" Padding="12">
              <StackPanel Spacing="10">
                <TextBlock Text="导出与日志" Foreground="#E9EDF4" FontWeight="SemiBold" FontSize="16"/>
                <StackPanel Orientation="Horizontal" Spacing="10">
                  <Button x:Name="ConvertButton" Content="导出 JSON" Width="150" Height="38" Background="#2D78FF" Foreground="White" BorderBrush="#2D78FF" ToolTip.Tip="按照当前设置生成并保存 JSON 文件"/>
                  <TextBlock x:Name="StatusText" VerticalAlignment="Center" Foreground="#8AB4FF" Text="等待操作..." />
                </StackPanel>
                <Border Background="#1F2024" BorderBrush="#3A3B40" BorderThickness="1" CornerRadius="8" Padding="10" Height="200">
                  <TextBox x:Name="LogBox" IsReadOnly="True" TextWrapping="Wrap" AcceptsReturn="True" Background="Transparent" BorderThickness="0" Foreground="#E9EDF4" Watermark="操作日志将显示在此处"/>
                </Border>
              </StackPanel>
            </Border>
          </StackPanel>
        </ScrollViewer>

        <!-- 分隔条 -->
        <GridSplitter Grid.Column="1"
                      Width="8"
                      HorizontalAlignment="Center"
                      Background="#303136"
                      ResizeDirection="Columns"
                      ShowsPreview="True"/>

        <!-- 右侧预览区域 -->
        <Grid Grid.Column="2" RowDefinitions="Auto,*" ColumnDefinitions="*" Margin="10,0,0,0" MinWidth="380">
          <Border Grid.Row="0" Background="#2F3035" CornerRadius="10" Padding="12">
            <StackPanel Spacing="6">
              <StackPanel Orientation="Horizontal" Spacing="8">
                <TextBlock Text="JSON 预览" Foreground="#E9EDF4" FontSize="18" FontWeight="SemiBold"/>
                <TextBlock x:Name="PreviewStatusText" Foreground="#8AB4FF" VerticalAlignment="Center" Text="等待选择文件..." />
                <Button x:Name="CopyPreviewButton"
                        Content="复制预览"
                        MinWidth="90"
                        Padding="12,6"
                        Background="#2F3035"
                        Foreground="#E9EDF4"
                        BorderBrush="#3A3B40"
                        ToolTip.Tip="将当前预览内容复制到剪贴板"/>
              </StackPanel>
              <TextBlock Foreground="#9DA5B4" Text="右侧预览与导出结果保持一致，含缩进与空白；颜色区分键与不同类型的值。"/>
            </StackPanel>
          </Border>

          <Border Grid.Row="1" Background="#1F2024" BorderBrush="#3A3B40" BorderThickness="1" CornerRadius="8" Padding="10">
            <Grid>
              <TextBlock x:Name="PreviewWatermark"
                         FontSize="14"
                         Foreground="#8C8F99"
                         Opacity="0.7"
                         TextAlignment="Center"
                         TextWrapping="Wrap"
                         Margin="24"
                         HorizontalAlignment="Center"
                         VerticalAlignment="Center"
                         Text="// 请拖拽或选择 Excel/CSV 文件以生成预览。"/>
              <ScrollViewer VerticalScrollBarVisibility="Auto"
                            HorizontalScrollBarVisibility="Auto"
                            Background="Transparent"
                            BorderThickness="0">
                <TextBlock x:Name="PreviewBlock"
                           FontFamily="Consolas, 'Cascadia Code', 'Courier New', monospace"
                           FontSize="13"
                           Foreground="#E9EDF4"
                           TextAlignment="Left"
                           TextWrapping="NoWrap"
                           Text=""/>
              </ScrollViewer>
            </Grid>
          </Border>
        </Grid>
      </Grid>
    </DockPanel>
  </Border>
</Window>
